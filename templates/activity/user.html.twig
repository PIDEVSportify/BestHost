{% extends 'base.html.twig' %}

 {% block title %}Activity index{% endblock %}

{% block body %}
    <h1>Activity index</h1>

        <tbody>

        <div class="container">
            {% for activity in activities %}

            <div class="card" style="width: 25rem;">
                <div class="card-body">
                    <h5 class="card-title">{{ activity.Type }}</h5>
                    <p class="card-text">{{ activity.Description }}</p>
                    <a href="{{ path('act_like', {'id': activity.id}) }}" class="btn btn-primary js-likes">
                        {% if app.user and activity.isLikedByUser(app.user) %}
                         <i class="fas fa-thumbs-up"></i>
                        {% else %}
                        <i class="far fa-thumbs-up"></i>
                         {% endif %}
                        <span class="js-likes"> {{ activity.likes | length }}
                        </span>
                        <span class="js-label">J'aime</span>
                    </a>
                    <a  href="{{ path('us_show', {'id': activity.id}) }}" class="btn btn-primary">Show</a>
                </div>
            </div>
          </div>
        {% else %}
            <tr>
                <td colspan="7">no records found</td>
            </tr>

        {% endfor %}

        </tbody>

    <a href="{{ path('activity_new') }}" >Create new</a>
{% endblock %}

{% block js %}
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        function  onClickBtnLike(){
            event.preventDefault();
            const url = this.href;
            const spanCount = this.querySelector('span.js-likes');
            const icone=this.querySelector('i');
            axios.get(url).then (function (response)
            {
                const likes = response.data.likes;
                spanCount.textContent = likes;
                if (icone.classList.contains('fas'))
                {
                    icone.classList.replace('fas','far');
                }
                else
                {
                    icone.classList.replace('far','fas');
                }

            }).catch(function (error){
                if (error.response.status===403){
                    window.alert("vous ne pouvez pas faire un like")
                } else {
                    window.alert("une erreur s'est produite");
                }
            });
        }
        document.querySelectorAll('a.js-like').forEach(function(link){
            link.addEventListener('click',onClickBtnLike);
        })
    </script>

{% endblock %}